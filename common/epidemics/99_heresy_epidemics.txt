heresy_iconoclasm = {
	trait = heresiarch
	color = blue
	priority = 5

	shader_data = {
		strength = 0.8
		edge_fade = 0.4
		tile_multiplier = 0.005
		texture_index = 0
		channel = blue
	}

	name = epidemic_heresy_iconoclasm


	on_start = {
		if = {
			limit = { NOT = { has_global_variable = heresy_iconoclasm_happened } }
			set_global_variable = {
				name = heresy_iconoclasm_happened
				value = 1
			}
		}
		else = {
			change_global_variable = {
				name = heresy_iconoclasm_happened
				add = 1
			}
		}

		# LEGITIMACY LOSS FROM EPIDEMIC OUTBREAK
		epidemic_outbreak_legitimacy_effect = { PROVINCE = root.outbreak_province }
	}
	# on_end = {}
	on_monthly = {
		trigger_event = {
			on_action = epidemic_heresy_ongoing_events
		}
	}


	character_infection_chance = {
		value = 80
	}
	can_infect_character = {
		NOT = { faith = faith:iconoclast }
		immune_to_epidemic = { EPIDEMIC = scope:epidemic }
	}
	on_character_infected = {
		trigger_event = epidemic_heresy_events.0001
		if = {
			limit = {
				is_commanding_army = yes
			}
			trigger_event = epidemic_heresy_events.0001
		}
	}

	infection_levels = {
		10 = {
			province_modifier = {
				county_opinion_add = -2
				epidemic_travel_danger = 10
				development_decline = -1
			}	
		}
		50 = {
			province_modifier = {
				county_opinion_add = -3
				epidemic_travel_danger = 20
				development_decline = -2
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.1
				supply_limit_mult = -0.2
				county_opinion_add = -5
				epidemic_travel_danger = 30
				development_decline = -3
			}
		}
	}

	outbreak_intensities = {
		minor = {
			outbreak_chance = {
				value = outbreak_chance_minor_default_value
				multiply = outbreak_chance_minor_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 2
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 15 30 }

			infection_duration = {
				months = { 6 8 }
			}

			infection_progress_duration = {
				days = { 80 120 }
			}

			infection_recovery_duration = {
				days = { 15 22 }
			}
		}

		major = {
			outbreak_chance = {
				value = outbreak_chance_major_default_value
				multiply = outbreak_chance_major_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 1.5
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 45 70 }

			infection_duration = {
				months = { 10 20 }
			}

			infection_progress_duration = {
				days = { 40 60 }
			}

			infection_recovery_duration = {
				days = 25
			}
		}

		apocalyptic = {
			outbreak_chance = {
				value = outbreak_chance_apocalyptic_default_value
				multiply = outbreak_chance_apocalyptic_mult_value
				multiply = recent_epidemics_outbreak_mult_value
				
				### NO DLC - We increase the chance to make up for the locked diseases ###
				if = {
					limit = {
						NOT = { has_dlc_feature = legends_of_the_dead }
					}
					multiply = 1.25
				}
			}
			spread_chance = {
				value = spread_chance_epidemics_default_value
				multiply = spread_chance_epidemics_mult_value
			}
			max_provinces = { 120 180 }

			infection_duration = {
				months = { 22 40 }
			}
			
			infection_progress_duration = {
				days = { 15 20 }
			}

			infection_recovery_duration = {
				days = { 25 35 }
			}
		}
	}
	
	on_province_infected = {
		county = {
			apply_infection_development_loss = { BASE = 5 }
		}
		# cant_touch_this_achievement_effect = yes
	}
	
	on_province_recovered = {
		county = {
			remove_isolated_capital_modifiers_effect = yes
		}
		add_to_variable_list = {
			name = epidemic_cooldown
			target = scope:epidemic.epidemic_type
			years = 50
		}
		set_variable = {
			name = epidemic_cooldown_general
			years = 15
		}
		# Prosperity event
		plague_recovery_event_effect = yes
	}
}